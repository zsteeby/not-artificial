<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>not-artificial</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v1.3.0/turf.min.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
<div id='map'></div>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiY3Jvd2UtcmlkbGV5IiwiYSI6ImpjTGdpUW8ifQ.m5WtjYTE8_lH8wYrIlL9PQ';

var map = L.mapbox.map('map', 'crowe-ridley.l3agb24d')
    .setView([39.538, -97.339], 5);

//add Royals game data	
var sourceData = {"type": "FeatureCollection", "features": [{"type":"Feature","geometry":{"type":"Point","coordinates":[-83.048697,42.338928]},"properties":{"id":1,"date":"2014-03-31T00:00:00Z","latitude":42.338928,"longitude":-83.048697,"opponent":"Tigers","outcome":"L","margin":-1,"stadium":"Comerica Park","location":"Away","cartodb_id":1,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-83.048697,42.338928]},"properties":{"id":2,"date":"2014-04-02T00:00:00Z","latitude":42.338928,"longitude":-83.048697,"opponent":"Tigers","outcome":"L","margin":-1,"stadium":"Comerica Park","location":"Away","cartodb_id":2,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":3,"date":"2014-04-04T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"White Sox","outcome":"W","margin":2,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":3,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":4,"date":"2014-04-05T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"White Sox","outcome":"W","margin":1,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":4,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":5,"date":"2014-04-06T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"White Sox","outcome":"L","margin":-4,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":5,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":6,"date":"2014-04-07T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"Rays","outcome":"W","margin":2,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":6,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":7,"date":"2014-04-08T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"Rays","outcome":"L","margin":-1,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":7,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-94.480196,39.051494]},"properties":{"id":8,"date":"2014-04-09T00:00:00Z","latitude":39.051494,"longitude":-94.480196,"opponent":"Rays","outcome":"W","margin":4,"stadium":"Kauffman Stadium","location":"Home","cartodb_id":8,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-93.277475,44.982172]},"properties":{"id":9,"date":"2014-04-11T00:00:00Z","latitude":44.982172,"longitude":-93.277475,"opponent":"Twins","outcome":"L","margin":0,"stadium":"Target Field","location":"Away","cartodb_id":9,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-93.277475,44.982172]},"properties":{"id":10,"date":"2014-04-12T00:00:00Z","latitude":44.982172,"longitude":-93.277475,"opponent":"Twins","outcome":"L","margin":-6,"stadium":"Target Field","location":"Away","cartodb_id":10,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-93.277475,44.982172]},"properties":{"id":11,"date":"2014-04-13T00:00:00Z","latitude":44.982172,"longitude":-93.277475,"opponent":"Twins","outcome":"L","margin":-1,"stadium":"Target Field","location":"Away","cartodb_id":11,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-95.355452,29.757716]},"properties":{"id":12,"date":"2014-04-15T00:00:00Z","latitude":29.757716,"longitude":-95.355452,"opponent":"Astros","outcome":"W","margin":2,"stadium":"Minute Maid Park","location":"Away","cartodb_id":12,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-95.355452,29.757716]},"properties":{"id":13,"date":"2014-04-16T00:00:00Z","latitude":29.757716,"longitude":-95.355452,"opponent":"Astros","outcome":"W","margin":2,"stadium":"Minute Maid Park","location":"Away","cartodb_id":13,"created_at":"2015-02-02T04:36:34Z","updated_at":"2015-02-02T04:36:34Z"}}]}

var stateData = L.mapbox.featureLayer()
  .loadURL('states.geojson')
  .addTo(map);  

//filter feature collection
var key = "location";
var value = "Away";
var awayGames = turf.filter(sourceData, key, value);
var filter = L.mapbox.featureLayer(awayGames)
  .addTo(map);

// Bind a popup to each feature
filter.eachLayer(function (layer) {
  layer.bindPopup('<strong>' + layer.feature.properties.stadium + '</strong>', { closeButton: false });
  }).addTo(map);

filter.on('mouseover', function(e) {
    e.layer.openPopup();
});
filter.on('mouseout', function(e) {
    e.layer.closePopup();
});
</script>
</body>
</html>
